<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>毎日リセット習慣トラッカー</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 500px;
    margin: 2em auto;
    padding: 1em;
    background: #f9f9f9;
  }
  h1 {
    text-align: center;
  }
  #habit-form {
    display: flex;
    margin-bottom: 1em;
  }
  #habit-name {
    flex: 1;
    padding: 0.5em;
    font-size: 1em;
  }
  #add-btn {
    padding: 0.5em 1em;
    margin-left: 0.5em;
    font-size: 1em;
    cursor: pointer;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    background: white;
    margin-bottom: 0.5em;
    padding: 0.7em 1em;
    display: flex;
    align-items: center;
    border-radius: 4px;
    box-shadow: 0 0 3px #ccc;
  }
  li input[type="checkbox"] {
    margin-right: 1em;
    transform: scale(1.3);
    cursor: pointer;
  }
  .habit-text {
    flex: 1;
  }
  .delete-btn {
    background: #e74c3c;
    border: none;
    color: white;
    font-weight: bold;
    padding: 0.3em 0.7em;
    border-radius: 3px;
    cursor: pointer;
  }
  .delete-btn:hover {
    background: #c0392b;
  }
</style>
</head>
<body>

<h1>毎日リセット習慣トラッカー</h1>

<form id="habit-form">
  <input type="text" id="habit-name" placeholder="新しい習慣を追加" required />
  <button type="submit" id="add-btn">追加</button>
</form>

<ul id="habit-list"></ul>

<script>
  const form = document.getElementById('habit-form');
  const input = document.getElementById('habit-name');
  const habitList = document.getElementById('habit-list');

  // ローカルストレージのキー
  const STORAGE_KEY = 'dailyHabits';

  // 保存データの形式例: [{id:1,text:'歯磨き',done:false}, ...]

  // 今日の日付を yyyy-mm-dd 形式で取得
  function getToday() {
    const d = new Date();
    return d.toISOString().slice(0,10);
  }

  // ローカルストレージからデータ取得
  function loadHabits() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (!data) return [];
    try {
      const obj = JSON.parse(data);
      // 日付チェックして、日付が違えばチェック全部falseにリセット
      if (obj.date !== getToday()) {
        obj.habits.forEach(h => h.done = false);
        obj.date = getToday();
        saveHabits(obj);
      }
      return obj.habits;
    } catch {
      return [];
    }
  }

  // ローカルストレージに保存
  function saveHabits(obj) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
  }

  // 保存データを更新
  function updateStorage(habits) {
    saveHabits({date: getToday(), habits});
  }

  // UIに反映
  function renderHabits() {
    habitList.innerHTML = '';
    habits.forEach(habit => {
      const li = document.createElement('li');

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = habit.done;
      checkbox.addEventListener('change', () => {
        habit.done = checkbox.checked;
        updateStorage(habits);
      });

      const span = document.createElement('span');
      span.textContent = habit.text;
      span.className = 'habit-text';

      const delBtn = document.createElement('button');
      delBtn.textContent = '削除';
      delBtn.className = 'delete-btn';
      delBtn.addEventListener('click', () => {
        habits = habits.filter(h => h.id !== habit.id);
        updateStorage(habits);
        renderHabits();
      });

      li.appendChild(checkbox);
      li.appendChild(span);
      li.appendChild(delBtn);
      habitList.appendChild(li);
    });
  }

  // 初期読み込み
  let habits = loadHabits();
  renderHabits();

  // 新規追加処理
  form.addEventListener('submit', e => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;
    // idは日時＋乱数などでユニークに
    const newHabit = {id: Date.now() + Math.random(), text, done: false};
    habits.push(newHabit);
    updateStorage(habits);
    renderHabits();
    input.value = '';
  });
</script>

</body>
</html>
